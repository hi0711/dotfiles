<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README - Sinatra</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Sinatra">Sinatra</a>
    <li><a href="#label-Table+of+Contents">Table of Contents</a>
    <li><a href="#label-Routes">Routes</a>
    <li><a href="#label-Conditions">Conditions</a>
    <li><a href="#label-Return+Values">Return Values</a>
    <li><a href="#label-Custom+Route+Matchers">Custom Route Matchers</a>
    <li><a href="#label-Static+Files">Static Files</a>
    <li><a href="#label-Views+-2F+Templates">Views / Templates</a>
    <li><a href="#label-Literal+Templates">Literal Templates</a>
    <li><a href="#label-Available+Template+Languages">Available Template Languages</a>
    <li><a href="#label-Haml+Templates">Haml Templates</a>
    <li><a href="#label-Erb+Templates">Erb Templates</a>
    <li><a href="#label-Builder+Templates">Builder Templates</a>
    <li><a href="#label-Nokogiri+Templates">Nokogiri Templates</a>
    <li><a href="#label-Sass+Templates">Sass Templates</a>
    <li><a href="#label-SCSS+Templates">SCSS Templates</a>
    <li><a href="#label-Less+Templates">Less Templates</a>
    <li><a href="#label-Liquid+Templates">Liquid Templates</a>
    <li><a href="#label-Markdown+Templates">Markdown Templates</a>
    <li><a href="#label-Textile+Templates">Textile Templates</a>
    <li><a href="#label-RDoc+Templates">RDoc Templates</a>
    <li><a href="#label-AsciiDoc+Templates">AsciiDoc Templates</a>
    <li><a href="#label-Radius+Templates">Radius Templates</a>
    <li><a href="#label-Markaby+Templates">Markaby Templates</a>
    <li><a href="#label-RABL+Templates">RABL Templates</a>
    <li><a href="#label-Slim+Templates">Slim Templates</a>
    <li><a href="#label-Creole+Templates">Creole Templates</a>
    <li><a href="#label-MediaWiki+Templates">MediaWiki Templates</a>
    <li><a href="#label-CoffeeScript+Templates">CoffeeScript Templates</a>
    <li><a href="#label-Stylus+Templates">Stylus Templates</a>
    <li><a href="#label-Yajl+Templates">Yajl Templates</a>
    <li><a href="#label-WLang+Templates">WLang Templates</a>
    <li><a href="#label-Accessing+Variables+in+Templates">Accessing Variables in Templates</a>
    <li><a href="#label-Templates+with+yield+and+nested+layouts">Templates with <code>yield</code> and nested layouts</a>
    <li><a href="#label-Inline+Templates">Inline Templates</a>
    <li><a href="#label-Named+Templates">Named Templates</a>
    <li><a href="#label-Associating+File+Extensions">Associating File Extensions</a>
    <li><a href="#label-Adding+Your+Own+Template+Engine">Adding Your Own Template Engine</a>
    <li><a href="#label-Using+Custom+Logic+for+Template+Lookup">Using Custom Logic for Template Lookup</a>
    <li><a href="#label-Filters">Filters</a>
    <li><a href="#label-Helpers">Helpers</a>
    <li><a href="#label-Using+Sessions">Using Sessions</a>
    <li><a href="#label-Halting">Halting</a>
    <li><a href="#label-Passing">Passing</a>
    <li><a href="#label-Triggering+Another+Route">Triggering Another Route</a>
    <li><a href="#label-Setting+Body-2C+Status+Code+and+Headers">Setting Body, Status Code and Headers</a>
    <li><a href="#label-Streaming+Responses">Streaming Responses</a>
    <li><a href="#label-Logging">Logging</a>
    <li><a href="#label-Mime+Types">Mime Types</a>
    <li><a href="#label-Generating+URLs">Generating URLs</a>
    <li><a href="#label-Browser+Redirect">Browser Redirect</a>
    <li><a href="#label-Cache+Control">Cache Control</a>
    <li><a href="#label-Sending+Files">Sending Files</a>
    <li><a href="#label-Accessing+the+Request+Object">Accessing the Request Object</a>
    <li><a href="#label-Attachments">Attachments</a>
    <li><a href="#label-Dealing+with+Date+and+Time">Dealing with Date and Time</a>
    <li><a href="#label-Looking+Up+Template+Files">Looking Up Template Files</a>
    <li><a href="#label-Configuration">Configuration</a>
    <li><a href="#label-Configuring+attack+protection">Configuring attack protection</a>
    <li><a href="#label-Available+Settings">Available Settings</a>
    <li><a href="#label-Environments">Environments</a>
    <li><a href="#label-Error+Handling">Error Handling</a>
    <li><a href="#label-Not+Found">Not Found</a>
    <li><a href="#label-Error">Error</a>
    <li><a href="#label-Rack+Middleware">Rack Middleware</a>
    <li><a href="#label-Testing">Testing</a>
    <li><a href="#label-Sinatra-3A-3ABase+-+Middleware-2C+Libraries-2C+and+Modular+Apps">Sinatra::Base - Middleware, Libraries, and Modular Apps</a>
    <li><a href="#label-Modular+vs.+Classic+Style">Modular vs. Classic Style</a>
    <li><a href="#label-Serving+a+Modular+Application">Serving a Modular Application</a>
    <li><a href="#label-Using+a+Classic+Style+Application+with+a+config.ru">Using a Classic Style Application with a config.ru</a>
    <li><a href="#label-When+to+use+a+config.ru-3F">When to use a config.ru?</a>
    <li><a href="#label-Using+Sinatra+as+Middleware">Using Sinatra as Middleware</a>
    <li><a href="#label-Dynamic+Application+Creation">Dynamic Application Creation</a>
    <li><a href="#label-Scopes+and+Binding">Scopes and Binding</a>
    <li><a href="#label-Application-2FClass+Scope">Application/Class Scope</a>
    <li><a href="#label-Request-2FInstance+Scope">Request/Instance Scope</a>
    <li><a href="#label-Delegation+Scope">Delegation Scope</a>
    <li><a href="#label-Command+Line">Command Line</a>
    <li><a href="#label-Requirement">Requirement</a>
    <li><a href="#label-The+Bleeding+Edge">The Bleeding Edge</a>
    <li><a href="#label-With+Bundler">With Bundler</a>
    <li><a href="#label-Roll+Your+Own">Roll Your Own</a>
    <li><a href="#label-Install+Globally">Install Globally</a>
    <li><a href="#label-Versioning">Versioning</a>
    <li><a href="#label-Further+Reading">Further Reading</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./LICENSE.html">LICENSE</a>
  
    <li><a href="./README_de_md.html">README.de</a>
  
    <li><a href="./README_es_md.html">README.es</a>
  
    <li><a href="./README_fr_md.html">README.fr</a>
  
    <li><a href="./README_hu_md.html">README.hu</a>
  
    <li><a href="./README_ja_md.html">README.ja</a>
  
    <li><a href="./README_ko_md.html">README.ko</a>
  
    <li><a href="./README_md.html">README</a>
  
    <li><a href="./README_pt-br_md.html">README.pt-br</a>
  
    <li><a href="./README_pt-pt_md.html">README.pt-pt</a>
  
    <li><a href="./README_ru_md.html">README.ru</a>
  
    <li><a href="./README_zh_md.html">README.zh</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.md">

<h1 id="label-Sinatra"><a href="Sinatra.html">Sinatra</a><span><a href="#label-Sinatra">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="Sinatra.html">Sinatra</a> is a <a
href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> for
quickly creating web applications in Ruby with minimal effort:</p>

<pre class="ruby"><span class="ruby-comment"># myapp.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello world!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Install the gem:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">sinatra</span>
</pre>

<p>And run with:</p>

<pre class="ruby"><span class="ruby-identifier">ruby</span> <span class="ruby-identifier">myapp</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>View at: <a href="http://localhost:4567">localhost:4567</a></p>

<p>It is recommended to also run <code>gem install thin</code>, which <a
href="Sinatra.html">Sinatra</a> will pick up if available.</p>

<h2 id="label-Table+of+Contents">Table of Contents<span><a href="#label-Table+of+Contents">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="#sinatra">Sinatra</a>  <a href="#table-of-contents">Table of
Contents</a>  <a href="#routes">Routes</a>  <a
href="#conditions">Conditions</a>  <a href="#return-values">Return
Values</a>  <a href="#custom-route-matchers">Custom Route Matchers</a>  <a
href="#static-files">Static Files</a>  <a href="#views--templates">Views /
Templates</a>  <a href="#literal-templates">Literal Templates</a>  <a
href="#available-template-languages">Available Template Languages</a>  <a
href="#haml-templates">Haml Templates</a>  <a href="#erb-templates">Erb
Templates</a>  <a href="#builder-templates">Builder Templates</a>  <a
href="#nokogiri-templates">Nokogiri Templates</a>  <a
href="#sass-templates">Sass Templates</a>  <a href="#scss-templates">SCSS
Templates</a>  <a href="#less-templates">Less Templates</a>  <a
href="#liquid-templates">Liquid Templates</a>  <a
href="#markdown-templates">Markdown Templates</a>  <a
href="#textile-templates">Textile Templates</a>  <a
href="#rdoc-templates">RDoc Templates</a>  <a
href="#asciidoc-templates">AsciiDoc Templates</a>  <a
href="#radius-templates">Radius Templates</a>  <a
href="#markaby-templates">Markaby Templates</a>  <a
href="#rabl-templates">RABL Templates</a>  <a href="#slim-templates">Slim
Templates</a>  <a href="#creole-templates">Creole Templates</a>  <a
href="#mediawiki-templates">MediaWiki Templates</a>  <a
href="#coffeescript-templates">CoffeeScript Templates</a>  <a
href="#stylus-templates">Stylus Templates</a>  <a
href="#yajl-templates">Yajl Templates</a>  <a href="#wlang-templates">WLang
Templates</a>  <a href="#accessing-variables-in-templates">Accessing
Variables in Templates</a>  <a
href="#templates-with-yield-and-nested-layouts">Templates with yield and
nested layouts</a>  <a href="#inline-templates">Inline Templates</a>  <a
href="#named-templates">Named Templates</a>  <a
href="#associating-file-extensions">Associating File Extensions</a>  <a
href="#adding-your-own-template-engine">Adding Your Own Template Engine</a>
<a href="#using-custom-logic-for-template-lookup">Using Custom Logic for
Template Lookup</a>  <a href="#filters">Filters</a>  <a
href="#helpers">Helpers</a>  <a href="#using-sessions">Using Sessions</a> 
<a href="#halting">Halting</a>  <a href="#passing">Passing</a>  <a
href="#triggering-another-route">Triggering Another Route</a>  <a
href="#setting-body-status-code-and-headers">Setting Body, Status Code and
Headers</a>  <a href="#streaming-responses">Streaming Responses</a>  <a
href="#logging">Logging</a>  <a href="#mime-types">Mime Types</a>  <a
href="#generating-urls">Generating URLs</a>  <a
href="#browser-redirect">Browser Redirect</a>  <a
href="#cache-control">Cache Control</a>  <a href="#sending-files">Sending
Files</a>  <a href="#accessing-the-request-object">Accessing the Request
Object</a>  <a href="#attachments">Attachments</a>  <a
href="#dealing-with-date-and-time">Dealing with Date and Time</a>  <a
href="#looking-up-template-files">Looking Up Template Files</a>  <a
href="#configuration">Configuration</a>  <a
href="#configuring-attack-protection">Configuring attack protection</a>  <a
href="#available-settings">Available Settings</a>  <a
href="#environments">Environments</a>  <a href="#error-handling">Error
Handling</a>  <a href="#not-found">Not Found</a>  <a
href="#error">Error</a>  <a href="#rack-middleware">Rack Middleware</a>  <a
href="#testing">Testing</a>  <a
href="#sinatrabase---middleware-libraries-and-modular-apps">Sinatra::Base -
Middleware, Libraries, and Modular Apps</a>  <a
href="#modular-vs-classic-style">Modular vs. Classic Style</a>  <a
href="#serving-a-modular-application">Serving a Modular Application</a>  <a
href="#using-a-classic-style-application-with-a-configru">Using a Classic
Style Application with a config.ru</a>  <a
href="#when-to-use-a-configru">When to use a config.ru?</a>  <a
href="#using-sinatra-as-middleware">Using Sinatra as Middleware</a>  <a
href="#dynamic-application-creation">Dynamic Application Creation</a>  <a
href="#scopes-and-binding">Scopes and Binding</a>  <a
href="#applicationclass-scope">Application/Class Scope</a>  <a
href="#requestinstance-scope">Request/Instance Scope</a>  <a
href="#delegation-scope">Delegation Scope</a>  <a
href="#command-line">Command Line</a>  <a
href="#requirement">Requirement</a>  <a href="#the-bleeding-edge">The
Bleeding Edge</a>  <a href="#with-bundler">With Bundler</a>  <a
href="#roll-your-own">Roll Your Own</a>  <a
href="#install-globally">Install Globally</a>  <a
href="#versioning">Versioning</a>  <a href="#further-reading">Further
Reading</a></p>

<h2 id="label-Routes">Routes<span><a href="#label-Routes">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>In <a href="Sinatra.html">Sinatra</a>, a route is an HTTP method paired
with a URL-matching pattern. Each route is associated with a block:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">show</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">post</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">create</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">put</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">replace</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">patch</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">modify</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">annihilate</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">options</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">appease</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">link</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">affiliate</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">unlink</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">separate</span> <span class="ruby-identifier">something</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Routes are matched in the order they are defined. The first route that
matches the request is invoked.</p>

<p>Route patterns may include named parameters, accessible via the
<code>params</code> hash:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello/:name&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># matches &quot;GET /hello/foo&quot; and &quot;GET /hello/bar&quot;</span>
  <span class="ruby-comment"># params[&#39;name&#39;] is &#39;foo&#39; or &#39;bar&#39;</span>
  <span class="ruby-node">&quot;Hello #{params[&#39;name&#39;]}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can also access named parameters via block parameters:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello/:name&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># matches &quot;GET /hello/foo&quot; and &quot;GET /hello/bar&quot;</span>
  <span class="ruby-comment"># params[&#39;name&#39;] is &#39;foo&#39; or &#39;bar&#39;</span>
  <span class="ruby-comment"># n stores params[&#39;name&#39;]</span>
  <span class="ruby-node">&quot;Hello #{n}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Route patterns may also include splat (or wildcard) parameters, accessible
via the <code>params['splat']</code> array:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/say  /to/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># matches /say/hello/to/world</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;hello&quot;, &quot;world&quot;]</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># matches /download/path/to/file.xml</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Or with block parameters:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
  [<span class="ruby-identifier">path</span>, <span class="ruby-identifier">ext</span>] <span class="ruby-comment"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Route matching with Regular Expressions:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">/\A\/hello\/([\w]+)\z/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;Hello, #{params[&#39;captures&#39;].first}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Or with a block parameter:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{/hello/([\w]+)}</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># Matches &quot;GET /meta/hello/world&quot;, &quot;GET /hello/world/1234&quot; etc.</span>
  <span class="ruby-node">&quot;Hello, #{c}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Route patterns may have optional parameters:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/posts.?:format?&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># matches &quot;GET /posts&quot; and any extension &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot; etc.</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Routes may also utilize query parameters:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/posts&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># matches &quot;GET /posts?title=foo&amp;author=bar&quot;</span>
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;title&#39;</span>]
  <span class="ruby-identifier">author</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;author&#39;</span>]
  <span class="ruby-comment"># uses title and author variables; query is optional to the /posts route</span>
<span class="ruby-keyword">end</span>
</pre>

<p>By the way, unless you disable the path traversal attack protection (see
below), the request path might be modified before matching against your
routes.</p>

<h2 id="label-Conditions">Conditions<span><a href="#label-Conditions">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Routes may include a variety of matching conditions, such as the user
agent:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span>, :<span class="ruby-identifier">agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;You&#39;re using Songbird version #{params[&#39;agent&#39;][0]}&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># Matches non-songbird browsers</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Other available conditions are <code>host_name</code> and
<code>provides</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">host_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/^admin\./</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Admin Area, Access denied!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;html&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;rss&#39;</span>, <span class="ruby-string">&#39;atom&#39;</span>, <span class="ruby-string">&#39;xml&#39;</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">builder</span> :<span class="ruby-identifier">feed</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>provides</code> searches the request&#39;s Accept header.</p>

<p>You can easily define your own conditions:</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">probability</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">condition</span> { <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">value</span> } }

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/win_a_car&#39;</span>, :<span class="ruby-identifier">probability</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0.1</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;You won!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/win_a_car&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Sorry, you lost.&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>For a condition that takes multiple values use a splat:</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">auth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">roles</span><span class="ruby-operator">|</span>   <span class="ruby-comment"># &lt;- notice the splat here</span>
  <span class="ruby-identifier">condition</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">in_role?</span> <span class="ruby-identifier">role</span> }
      <span class="ruby-identifier">redirect</span> <span class="ruby-string">&quot;/login/&quot;</span>, <span class="ruby-value">303</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/my/account/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">user</span>, :<span class="ruby-identifier">admin</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Your Account Details&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/only/admin/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">admin</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Only admins are allowed here!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Return+Values">Return Values<span><a href="#label-Return+Values">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The return value of a route block determines at least the response body
passed on to the HTTP client, or at least the next middleware in the <a
href="Rack.html">Rack</a> stack. Most commonly, this is a string, as in the
above examples. But other values are also accepted.</p>

<p>You can return any object that would either be a valid <a
href="Rack.html">Rack</a> response, <a href="Rack.html">Rack</a> body
object or HTTP status code:</p>

<p>An Array with three elements: <code>[status (Fixnum), headers (Hash),
response   body (responds to #each)]</code>  An Array with two elements:
<code>[status (Fixnum), response body (responds to   #each)]</code>  An
object that responds to <code>#each</code> and passes nothing but strings
to  the given block  A Fixnum representing the status code</p>

<p>That way we can, for instance, easily implement a streaming example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Stream</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>
    <span class="ruby-value">100</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-node">&quot;#{i}\n&quot;</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-constant">Stream</span>.<span class="ruby-identifier">new</span> }
</pre>

<p>You can also use the <code>stream</code> helper method (described below) to
reduce boiler plate and embed the streaming logic in the route.</p>

<h2 id="label-Custom+Route+Matchers">Custom Route Matchers<span><a href="#label-Custom+Route+Matchers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>As shown above, <a href="Sinatra.html">Sinatra</a> ships with built-in
support for using String patterns and regular expressions as route matches.
However, it does not stop there. You can easily define your own matchers:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AllButPattern</span>
  <span class="ruby-constant">Match</span> = <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">captures</span>)

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">except</span>)
    <span class="ruby-ivar">@except</span>   = <span class="ruby-identifier">except</span>
    <span class="ruby-ivar">@captures</span> = <span class="ruby-constant">Match</span>.<span class="ruby-identifier">new</span>([])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">match</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@captures</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@except</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-identifier">pattern</span>)
  <span class="ruby-constant">AllButPattern</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-string">&quot;/index&quot;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note that the above example might be over-engineered, as it can also be
expressed as:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">//</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/index&quot;</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Or, using negative look ahead:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{^(?!/index$)}</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Static+Files">Static Files<span><a href="#label-Static+Files">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Static files are served from the <code>./public</code> directory. You can
specify a different location by setting the <code>:public_folder</code>
option:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">public_folder</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/static&#39;</span>
</pre>

<p>Note that the public directory name is not included in the URL. A file
<code>./public/css/style.css</code> is made available as
<code>http://example.com/css/style.css</code>.</p>

<p>Use the <code>:static_cache_control</code> setting (see below) to add
<code>Cache-Control</code> header info.</p>

<h2 id="label-Views+-2F+Templates">Views / Templates<span><a href="#label-Views+-2F+Templates">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Each template language is exposed via its own rendering method. These
methods simply return a string:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This renders <code>views/index.erb</code>.</p>

<p>Instead of a template name, you can also just pass in the template content
directly:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">code</span> = <span class="ruby-string">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="ruby-identifier">erb</span> <span class="ruby-identifier">code</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Templates take a second argument, the options hash:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">post</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This will render <code>views/index.erb</code> embedded in the
<code>views/post.erb</code> (default is <code>views/layout.erb</code>, if
it exists).</p>

<p>Any options not understood by <a href="Sinatra.html">Sinatra</a> will be
passed on to the template engine:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can also set options per template language in general:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">haml</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Options passed to the render method override options set via
<code>set</code>.</p>

<p>Available Options:</p>
<dl>
  <dt>locals</dt>
  <dd>
    List of locals passed to the document. Handy with partials.
    Example: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    String encoding to use if uncertain. Defaults to
    <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Views folder to load templates from. Defaults to <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Whether to use a layout (<tt>true</tt> or <tt>false</tt>). If it's a
    Symbol, specifies what template to use. Example:
    <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type the template produces. Default depends on template language.
  </dd>

  <dt>scope</dt>
  <dd>
    Scope to render template under. Defaults to the application instance. If you
    change this, instance variables and helper methods will not be available.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    Template engine to use for rendering the layout. Useful for languages that
    do not support layouts otherwise. Defaults to the engine used for the
    template. Example: <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>

  <dt>layout_options</dt>
  <dd>
    Special options only used for rendering the layout. Example:
    <tt>set :rdoc, :layout_options => { :views => 'views/layouts' }</tt>
  </dd>
</dl>
<p>Templates are assumed to be located directly under the <code>./views</code>
directory. To use a different views directory:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/templates&#39;</span>
</pre>

<p>One important thing to remember is that you always have to reference
templates with symbols, even if they&#39;re in a subdirectory (in this
case, use: <code>:&#39;subdir/template&#39;</code> or
<code>&#39;subdir/template&#39;.to_sym</code>). You must use a symbol
because otherwise rendering methods will render any strings passed to them
directly.</p>

<h3 id="label-Literal+Templates">Literal Templates<span><a href="#label-Literal+Templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%div.title Hello World&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Renders the template string.</p>

<h3 id="label-Available+Template+Languages">Available Template Languages<span><a href="#label-Available+Template+Languages">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Some languages have multiple implementations. To specify what
implementation to use (and to be thread-safe), you should simply require it
first:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdiscount&#39;</span> <span class="ruby-comment"># or require &#39;bluecloth&#39;</span>
<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-identifier">markdown</span> :<span class="ruby-identifier">index</span> }
</pre>

<h4 id="label-Haml+Templates">Haml Templates<span><a href="#label-Haml+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>
<h4 id="label-Erb+Templates">Erb Templates<span><a href="#label-Erb+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      or erb (included in Ruby)
    </td>
  </tr>
  <tr>
    <td>File Extensions</td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> (Erubis only)</td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>
<h4 id="label-Builder+Templates">Builder Templates<span><a href="#label-Builder+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="https://github.com/jimweirich/builder" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>It also takes a block for inline templates (see example).</p>

<h4 id="label-Nokogiri+Templates">Nokogiri Templates<span><a href="#label-Nokogiri+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>It also takes a block for inline templates (see example).</p>

<h4 id="label-Sass+Templates">Sass Templates<span><a href="#label-Sass+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-SCSS+Templates">SCSS Templates<span><a href="#label-SCSS+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-Less+Templates">Less Templates<span><a href="#label-Less+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>
<h4 id="label-Liquid+Templates">Liquid Templates<span><a href="#label-Liquid+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Since you cannot call Ruby methods (except for <code>yield</code>) from a
Liquid template, you almost always want to pass locals to it.</p>

<h4 id="label-Markdown+Templates">Markdown Templates<span><a href="#label-Markdown+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td>
      Anyone of:
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.gettalong.org/" title="kramdown">kramdown</a>,
        <a href="https://github.com/bhollis/maruku" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td>File Extensions</td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from markdown, nor to pass locals to it.
You therefore will usually use it in combination with another rendering
engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>markdown</code> method from within
other templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Since you cannot call Ruby from Markdown, you cannot use layouts written in
Markdown. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code>
option.</p>

<h4 id="label-Textile+Templates">Textile Templates<span><a href="#label-Textile+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from textile, nor to pass locals to it.
You therefore will usually use it in combination with another rendering
engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>textile</code> method from within
other templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Since you cannot call Ruby from Textile, you cannot use layouts written in
Textile. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code>
option.</p>

<h4 id="label-RDoc+Templates">RDoc Templates<span><a href="#label-RDoc+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://rdoc.sourceforge.net/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from rdoc, nor to pass locals to it. You
therefore will usually use it in combination with another rendering engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>rdoc</code> method from within other
templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Since you cannot call Ruby from RDoc, you cannot use layouts written in
RDoc. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code>
option.</p>

<h4 id="label-AsciiDoc+Templates">AsciiDoc Templates<span><a href="#label-AsciiDoc+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.asciidoc</tt>, <tt>.adoc</tt> and <tt>.ad</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>asciidoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Since you cannot call Ruby methods directly from an AsciiDoc template, you
almost always want to pass locals to it.</p>

<h4 id="label-Radius+Templates">Radius Templates<span><a href="#label-Radius+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/jlong/radius" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Since you cannot call Ruby methods directly from a Radius template, you
almost always want to pass locals to it.</p>

<h4 id="label-Markaby+Templates">Markaby Templates<span><a href="#label-Markaby+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>
<p>It also takes a block for inline templates (see example).</p>

<h4 id="label-RABL+Templates">RABL Templates<span><a href="#label-RABL+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>
<h4 id="label-Slim+Templates">Slim Templates<span><a href="#label-Slim+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>
<h4 id="label-Creole+Templates">Creole Templates<span><a href="#label-Creole+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from creole, nor to pass locals to it.
You therefore will usually use it in combination with another rendering
engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>creole</code> method from within
other templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Since you cannot call Ruby from Creole, you cannot use layouts written in
Creole. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code>
option.</p>

<h4 id="label-MediaWiki+Templates">MediaWiki Templates<span><a href="#label-MediaWiki+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/nricciar/wikicloth" title="WikiCloth">WikiCloth</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.mediawiki</tt> and <tt>.mw</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>mediawiki :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from MediaWiki markup, nor to pass
locals to it. You therefore will usually use it in combination with another
rendering engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mediawiki</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>mediawiki</code> method from within
other templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">mediawiki</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Since you cannot call Ruby from MediaWiki, you cannot use layouts written
in MediaWiki. However, it is possible to use another rendering engine for
the template than for the layout by passing the <code>:layout_engine</code>
option.</p>

<h4 id="label-CoffeeScript+Templates">CoffeeScript Templates<span><a href="#label-CoffeeScript+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>
<h4 id="label-Stylus+Templates">Stylus Templates<span><a href="#label-Stylus+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.styl</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>
<p>Before being able to use Stylus templates, you need to load
<code>stylus</code> and <code>stylus/tilt</code> first:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus/tilt&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">stylus</span> :<span class="ruby-identifier">example</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-Yajl+Templates">Yajl Templates<span><a href="#label-Yajl+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>
<p>The template source is evaluated as a Ruby string, and the resulting json
variable is converted using <code>#to_json</code>:</p>

<pre class="ruby"><span class="ruby-identifier">json</span> = { :<span class="ruby-identifier">foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;bar&#39;</span> }
<span class="ruby-identifier">json</span>[:<span class="ruby-identifier">baz</span>] = <span class="ruby-identifier">key</span>
</pre>

<p>The <code>:callback</code> and <code>:variable</code> options can be used
to decorate the rendered object:</p>

<pre>var resource = {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;qux&quot;};
present(resource);</pre>

<h4 id="label-WLang+Templates">WLang Templates<span><a href="#label-WLang+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/blambeau/wlang/" title="WLang">WLang</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>wlang :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Since calling ruby methods is not idiomatic in WLang, you almost always
want to pass locals to it. Layouts written in WLang and <code>yield</code>
are supported, though.</p>

<h3 id="label-Accessing+Variables+in+Templates">Accessing Variables in Templates<span><a href="#label-Accessing+Variables+in+Templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Templates are evaluated within the same context as route handlers. Instance
variables set in route handlers are directly accessible by templates:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= @foo.name&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Or, specify an explicit Hash of local variables:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= bar.name&#39;</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">bar</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">foo</span> }
<span class="ruby-keyword">end</span>
</pre>

<p>This is typically used when rendering templates as partials from within
other templates.</p>

<h3 id="label-Templates+with+yield+and+nested+layouts">Templates with <code>yield</code> and nested layouts<span><a href="#label-Templates+with+yield+and+nested+layouts">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A layout is usually just a template that calls <code>yield</code>. Such a
template can be used either through the <code>:template</code> option as
described above, or it can be rendered with a block as follows:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">post</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This code is mostly equivalent to <code>erb :index, :layout =&gt;
:post</code>.</p>

<p>Passing blocks to rendering methods is most useful for creating nested
layouts:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">main_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This can also be done in fewer lines of code with:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">main_layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Currently, the following rendering methods accept a block:
<code>erb</code>, <code>haml</code>, <code>liquid</code>,
<code>slim</code>, <code>wlang</code>. Also the general <code>render</code>
method accepts a block.</p>

<h3 id="label-Inline+Templates">Inline Templates<span><a href="#label-Inline+Templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Templates may be defined at the end of the source file:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

__END__

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">layout</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">tml</span>
  = <span class="ruby-keyword">yield</span>

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">index</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">iv</span>.<span class="ruby-identifier">title</span> <span class="ruby-constant">Hello</span> <span class="ruby-identifier">world</span>.
</pre>

<p>NOTE: Inline templates defined in the source file that requires sinatra are
automatically loaded. Call <code>enable :inline_templates</code> explicitly
if you have inline templates in other source files.</p>

<h3 id="label-Named+Templates">Named Templates<span><a href="#label-Named+Templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Templates may also be defined using the top-level <code>template</code>
method:</p>

<pre class="ruby"><span class="ruby-identifier">template</span> :<span class="ruby-identifier">layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;%html\n  =yield\n&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">template</span> :<span class="ruby-identifier">index</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;%div.title Hello World!&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If a template named layout exists, it will be used each time a template
is rendered. You can individually disable layouts by passing <code>:layout
=&gt; false</code> or disable them by default via <code>set :haml, :layout
=&gt; false</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Associating+File+Extensions">Associating File Extensions<span><a href="#label-Associating+File+Extensions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To associate a file extension with a template engine, use
<code>Tilt.register</code>. For instance, if you like to use the file
extension <code>tt</code> for Textile templates, you can do the following:</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">tt</span>, <span class="ruby-constant">Tilt</span>[:<span class="ruby-identifier">textile</span>]
</pre>

<h3 id="label-Adding+Your+Own+Template+Engine">Adding Your Own Template Engine<span><a href="#label-Adding+Your+Own+Template+Engine">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>First, register your engine with Tilt, then create a rendering method:</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">myat</span>, <span class="ruby-constant">MyAwesomeTemplateEngine</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">myat</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-identifier">render</span>(:<span class="ruby-identifier">myat</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">myat</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Renders <code>./views/index.myat</code>. See <a
href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a> to
learn more about Tilt.</p>

<h3 id="label-Using+Custom+Logic+for+Template+Lookup">Using Custom Logic for Template Lookup<span><a href="#label-Using+Custom+Logic+for+Template+Lookup">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To implement your own template lookup mechanism you can write your own
<code>#find_template</code> method:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span> [ <span class="ruby-string">&#39;./views/a&#39;</span>, <span class="ruby-string">&#39;./views/b&#39;</span> ]
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">Array</span>(<span class="ruby-identifier">views</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">super</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Filters">Filters<span><a href="#label-Filters">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Before filters are evaluated before each request within the same context as
the routes will be and can modify the request and response. Instance
variables set in filters are accessible by routes and templates:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@note</span> = <span class="ruby-string">&#39;Hi!&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-string">&#39;/foo/bar/baz&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@note</span> <span class="ruby-comment">#=&gt; &#39;Hi!&#39;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment">#=&gt; &#39;bar/baz&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>After filters are evaluated after each request within the same context as
the routes will be and can also modify the request and response. Instance
variables set in before filters and routes are accessible by after filters:</p>

<pre class="ruby"><span class="ruby-identifier">after</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note: Unless you use the <code>body</code> method rather than just
returning a String from the routes, the body will not yet be available in
the after filter, since it is generated later on.</p>

<p>Filters optionally take a pattern, causing them to be evaluated only if the
request path matches that pattern:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-string">&#39;/protected/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">authenticate!</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-string">&#39;/create/:slug&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">slug</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">last_slug</span>] = <span class="ruby-identifier">slug</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Like routes, filters also take conditions:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> :<span class="ruby-identifier">agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/Songbird/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-string">&#39;/blog/*&#39;</span>, :<span class="ruby-identifier">host_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;example.com&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Helpers">Helpers<span><a href="#label-Helpers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Use the top-level <code>helpers</code> method to define helper methods for
use in route handlers and templates:</p>

<pre class="ruby"><span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">name</span>)
    <span class="ruby-node">&quot;#{name}bar&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:name&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>])
<span class="ruby-keyword">end</span>
</pre>

<p>Alternatively, helper methods can be separately defined in a module:</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">FooUtils</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">foo</span>(<span class="ruby-identifier">name</span>) <span class="ruby-node">&quot;#{name}foo&quot;</span> <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">module</span> <span class="ruby-constant">BarUtils</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">name</span>) <span class="ruby-node">&quot;#{name}bar&quot;</span> <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-constant">FooUtils</span>, <span class="ruby-constant">BarUtils</span>
</pre>

<p>The effect is the same as including the modules in the application class.</p>

<h3 id="label-Using+Sessions">Using Sessions<span><a href="#label-Using+Sessions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A session is used to keep state during requests. If activated, you have one
session hash per user session:</p>

<pre class="ruby"><span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>Note that <code>enable :sessions</code> actually stores all data in a
cookie. This might not always be what you want (storing lots of data will
increase your traffic, for instance). You can use any <a
href="Rack.html">Rack</a> session middleware: in order to do so, do
<strong>not</strong> call <code>enable :sessions</code>, but instead pull
in your middleware of choice as you would any other middleware:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Pool</span>, :<span class="ruby-identifier">expire_after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2592000</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>To improve security, the session data in the cookie is signed with a
session secret. A random secret is generated for you by <a
href="Sinatra.html">Sinatra</a>. However, since this secret will change
with every start of your application, you might want to set the secret
yourself, so all your application instances share it:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">session_secret</span>, <span class="ruby-string">&#39;super secret&#39;</span>
</pre>

<p>If you want to configure it further, you may also store a hash with options
in the <code>sessions</code> setting:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;foo.com&#39;</span>
</pre>

<p>To share your session across other apps on subdomains of foo.com, prefix
the domain with a <em>.</em> like this instead:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.foo.com&#39;</span>
</pre>

<h3 id="label-Halting">Halting<span><a href="#label-Halting">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To immediately stop a request within a filter or route use:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span>
</pre>

<p>You can also specify the status when halting:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">410</span>
</pre>

<p>Or the body:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-string">&#39;this will be the body&#39;</span>
</pre>

<p>Or both:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">401</span>, <span class="ruby-string">&#39;go away!&#39;</span>
</pre>

<p>With headers:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, {<span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>}, <span class="ruby-string">&#39;revenge&#39;</span>
</pre>

<p>It is of course possible to combine a template with <code>halt</code>:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-identifier">erb</span>(:<span class="ruby-identifier">error</span>)
</pre>

<h3 id="label-Passing">Passing<span><a href="#label-Passing">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A route can punt processing to the next matching route using
<code>pass</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/guess/:who&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;who&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Frank&#39;</span>
  <span class="ruby-string">&#39;You got me!&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/guess/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;You missed!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The route block is immediately exited and control continues with the next
matching route. If no matching route is found, a 404 is returned.</p>

<h3 id="label-Triggering+Another+Route">Triggering Another Route<span><a href="#label-Triggering+Another+Route">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sometimes <code>pass</code> is not what you want, instead you would like to
get the result of calling another route. Simply use <code>call</code> to
achieve this:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">call</span> <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-string">&quot;PATH_INFO&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;/bar&#39;</span>)
  [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span>:<span class="ruby-identifier">upcase</span>)]
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;bar&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note that in the example above, you would ease testing and increase
performance by simply moving <code>&quot;bar&quot;</code> into a helper
used by both <code>/foo</code> and <code>/bar</code>.</p>

<p>If you want the request to be sent to the same application instance rather
than a duplicate, use <code>call!</code> instead of <code>call</code>.</p>

<p>Check out the <a href="Rack.html">Rack</a> specification if you want to
learn more about <code>call</code>.</p>

<h3 id="label-Setting+Body-2C+Status+Code+and+Headers">Setting Body, Status Code and Headers<span><a href="#label-Setting+Body-2C+Status+Code+and+Headers">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>It is possible and recommended to set the status code and response body
with the return value of the route block. However, in some scenarios you
might want to set the body at an arbitrary point in the execution flow. You
can do so with the <code>body</code> helper method. If you do so, you can
use that method from there on to access the body:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">body</span> <span class="ruby-string">&quot;bar&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">body</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It is also possible to pass a block to <code>body</code>, which will be
executed by the <a href="Rack.html">Rack</a> handler (this can be used to
implement streaming, see Return Values).</p>

<p>Similar to the body, you can also set the status code and headers:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">status</span> <span class="ruby-value">418</span>
  <span class="ruby-identifier">headers</span>      <span class="ruby-string">&quot;Allow&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;BREW, POST, GET, PROPFIND, WHEN&quot;</span>,
    <span class="ruby-string">&quot;Refresh&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;</span>
  <span class="ruby-identifier">body</span> <span class="ruby-string">&quot;I&#39;m a tea pot!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Like <code>body</code>, <code>headers</code> and <code>status</code> with
no arguments can be used to access their current values.</p>

<h3 id="label-Streaming+Responses">Streaming Responses<span><a href="#label-Streaming+Responses">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sometimes you want to start sending out data while still generating parts
of the response body. In extreme examples, you want to keep sending data
until the client closes the connection. You can use the <code>stream</code>
helper to avoid creating your own wrapper:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">stream</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;It&#39;s gonna be legen -\n&quot;</span>
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">0.5</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; (wait for it) \n&quot;</span>
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;- dary!\n&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This allows you to implement streaming APIs, <a
href="http://dev.w3.org/html5/eventsource/">Server Sent Events</a>, and can
be used as the basis for <a
href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>. It can also
be used to increase throughput if some but not all content depends on a
slow resource.</p>

<p>Note that the streaming behavior, especially the number of concurrent
requests, highly depends on the web server used to serve the application.
Some servers, like WEBRick, might not even support streaming at all. If the
server does not support streaming, the body will be sent all at once after
the block passed to <code>stream</code> finishes executing. Streaming does
not work at all with Shotgun.</p>

<p>If the optional parameter is set to <code>keep_open</code>, it will not
call <code>close</code> on the stream object, allowing you to close it at
any later point in the execution flow. This only works on evented servers,
like Thin and Rainbows. Other servers will still close the stream:</p>

<pre class="ruby"><span class="ruby-comment"># long polling</span>

<span class="ruby-identifier">set</span> :<span class="ruby-identifier">server</span>, :<span class="ruby-identifier">thin</span>
<span class="ruby-identifier">connections</span> = []

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/subscribe&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># register a client&#39;s interest in server events</span>
  <span class="ruby-identifier">stream</span>(:<span class="ruby-identifier">keep_open</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">connections</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">out</span>
    <span class="ruby-comment"># purge dead connections</span>
    <span class="ruby-identifier">connections</span>.<span class="ruby-identifier">reject!</span>(<span class="ruby-operator">&amp;</span>:<span class="ruby-identifier">closed?</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">post</span> <span class="ruby-string">&#39;/:message&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">connections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># notify client that a new message has arrived</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;message&#39;</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>

    <span class="ruby-comment">#indicate client to connect again</span>
    <span class="ruby-identifier">out</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># acknowledge</span>
  <span class="ruby-string">&quot;message received&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Logging">Logging<span><a href="#label-Logging">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In the request scope, the <code>logger</code> helper exposes a
<code>Logger</code> instance:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;loading data&quot;</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This logger will automatically take your <a href="Rack.html">Rack</a>
handler&#39;s logging settings into account. If logging is disabled, this
method will return a dummy object, so you do not have to worry about it in
your routes and filters.</p>

<p>Note that logging is only enabled for <code>Sinatra::Application</code> by
default, so if you inherit from <code>Sinatra::Base</code>, you probably
want to enable it yourself:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span>, :<span class="ruby-identifier">development</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">logging</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To avoid any logging middleware to be set up, set the <code>logging</code>
setting to <code>nil</code>. However, keep in mind that <code>logger</code>
will in that case return <code>nil</code>. A common use case is when you
want to set your own logger. <a href="Sinatra.html">Sinatra</a> will use
whatever it will find in <code>env['rack.logger']</code>.</p>

<h3 id="label-Mime+Types">Mime Types<span><a href="#label-Mime+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When using <code>send_file</code> or static files you may have mime types
<a href="Sinatra.html">Sinatra</a> doesn&#39;t understand. Use
<code>mime_type</code> to register them by file extension:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">mime_type</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;text/foo&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can also use it with the <code>content_type</code> helper:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">content_type</span> :<span class="ruby-identifier">foo</span>
  <span class="ruby-string">&quot;foo foo foo&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Generating+URLs">Generating URLs<span><a href="#label-Generating+URLs">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For generating URLs you should use the <code>url</code> helper method, for
instance, in Haml:</p>

<pre class="ruby"><span class="ruby-operator">%</span>{:<span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">url</span>(<span class="ruby-string">&#39;/foo&#39;</span>)} <span class="ruby-identifier">foo</span>
</pre>

<p>It takes reverse proxies and <a href="Rack.html">Rack</a> routers into
account, if present.</p>

<p>This method is also aliased to <code>to</code> (see below for an example).</p>

<h3 id="label-Browser+Redirect">Browser Redirect<span><a href="#label-Browser+Redirect">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can trigger a browser redirect with the <code>redirect</code> helper
method:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>)
<span class="ruby-keyword">end</span>
</pre>

<p>Any additional parameters are handled like arguments passed to
<code>halt</code>:</p>

<pre class="ruby"><span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>), <span class="ruby-value">303</span>
<span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;http://google.com&#39;</span>, <span class="ruby-string">&#39;wrong place, buddy&#39;</span>
</pre>

<p>You can also easily redirect back to the page the user came from with
<code>redirect back</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">do_something</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">back</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To pass arguments with a redirect, either add them to the query:</p>

<pre class="ruby"><span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar?sum=42&#39;</span>)
</pre>

<p>Or use a session:</p>

<pre class="ruby"><span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">secret</span>] = <span class="ruby-string">&#39;foo&#39;</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">secret</span>]
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Cache+Control">Cache Control<span><a href="#label-Cache+Control">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Setting your headers correctly is the foundation for proper HTTP caching.</p>

<p>You can easily set the Cache-Control header like this:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>
  <span class="ruby-string">&quot;cache it!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Pro tip: Set up caching in a before filter:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">must_revalidate</span>, :<span class="ruby-identifier">max_age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">60</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you are using the <code>expires</code> helper to set the corresponding
header, <code>Cache-Control</code> will be set automatically for you:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">expires</span> <span class="ruby-value">500</span>, :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">must_revalidate</span>
<span class="ruby-keyword">end</span>
</pre>

<p>To properly use caches, you should consider using <code>etag</code> or
<code>last_modified</code>. It is recommended to call those helpers
<em>before</em> doing any heavy lifting, as they will immediately flush a
response if the client already has the current version in its cache:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/article/:id&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@article</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>]
  <span class="ruby-identifier">last_modified</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">updated_at</span>
  <span class="ruby-identifier">etag</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">sha1</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">article</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It is also possible to use a <a
href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak
ETag</a>:</p>

<pre class="ruby"><span class="ruby-identifier">etag</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">sha1</span>, :<span class="ruby-identifier">weak</span>
</pre>

<p>These helpers will not do any caching for you, but rather feed the
necessary information to your cache. If you are looking for a quick
reverse-proxy caching solution, try <a
href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;rack/cache&quot;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;sinatra&quot;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">max_age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">36000</span>
  <span class="ruby-identifier">sleep</span> <span class="ruby-value">5</span>
  <span class="ruby-string">&quot;hello&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Use the <code>:static_cache_control</code> setting (see below) to add
<code>Cache-Control</code> header info to static files.</p>

<p>According to RFC 2616, your application should behave differently if the
If-Match or If-None-Match header is set to <code>*</code>, depending on
whether the resource requested is already in existence. <a
href="Sinatra.html">Sinatra</a> assumes resources for safe (like get) and
idempotent (like put) requests are already in existence, whereas other
resources (for instance post requests) are treated as new resources. You
can change this behavior by passing in a <code>:new_resource</code> option:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/create&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">etag</span> <span class="ruby-string">&#39;&#39;</span>, :<span class="ruby-identifier">new_resource</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-constant">Article</span>.<span class="ruby-identifier">create</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">new_article</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you still want to use a weak ETag, pass in a <code>:kind</code> option:</p>

<pre class="ruby"><span class="ruby-identifier">etag</span> <span class="ruby-string">&#39;&#39;</span>, :<span class="ruby-identifier">new_resource</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, :<span class="ruby-identifier">kind</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">weak</span>
</pre>

<h3 id="label-Sending+Files">Sending Files<span><a href="#label-Sending+Files">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>To return the contents of a file as the response, you can use the
<code>send_file</code> helper method:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">send_file</span> <span class="ruby-string">&#39;foo.png&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It also takes options:</p>

<pre class="ruby"><span class="ruby-identifier">send_file</span> <span class="ruby-string">&#39;foo.png&#39;</span>, :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">jpg</span>
</pre>

<p>The options are:</p>
<dl>
  <dt>filename</dt>
    <dd>File name to be used in the response, defaults to the real file name.</dd>

  <dt>last_modified</dt>
    <dd>Value for Last-Modified header, defaults to the file's mtime.</dd>

  <dt>type</dt>
    <dd>Value for Content-Type header, guessed from the file extension if
    missing.</dd>

  <dt>disposition</dt>
    <dd>
      Value for Content-Disposition header, possible values: <tt>nil</tt>
      (default), <tt>:attachment</tt> and <tt>:inline</tt>
    </dd>

  <dt>length</dt>
    <dd>Value for Content-Length header, defaults to file size.</dd>

  <dt>status</dt>
    <dd>
      Status code to be sent. Useful when sending a static file as an error page.

      If supported by the Rack handler, other means than streaming from the Ruby
      process will be used. If you use this helper method, Sinatra will
      automatically handle range requests.
    </dd>
</dl>
<h3 id="label-Accessing+the+Request+Object">Accessing the Request Object<span><a href="#label-Accessing+the+Request+Object">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The incoming request object can be accessed from request level (filter,
routes, error handlers) through the <code>request</code> method:</p>

<pre class="ruby"><span class="ruby-comment"># app running on http://example.com/example</span>
<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">t</span> = <span class="ruby-node">%w[text/css text/html application/javascript]</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">accept</span>              <span class="ruby-comment"># [&#39;text/html&#39;, &#39;  *&#39;]</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">accept?</span> <span class="ruby-string">&#39;text/xml&#39;</span>  <span class="ruby-comment"># true</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">preferred_type</span>(<span class="ruby-identifier">t</span>)   <span class="ruby-comment"># &#39;text/html&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>                <span class="ruby-comment"># request body sent by the client (see below)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">scheme</span>              <span class="ruby-comment"># &quot;http&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">script_name</span>         <span class="ruby-comment"># &quot;/example&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span>           <span class="ruby-comment"># &quot;/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">port</span>                <span class="ruby-comment"># 80</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_method</span>      <span class="ruby-comment"># &quot;GET&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">query_string</span>        <span class="ruby-comment"># &quot;&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_length</span>      <span class="ruby-comment"># length of request.body</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">media_type</span>          <span class="ruby-comment"># media type of request.body</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span>                <span class="ruby-comment"># &quot;example.com&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span>                <span class="ruby-comment"># true (similar methods for other verbs)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">form_data?</span>          <span class="ruby-comment"># false</span>
  <span class="ruby-identifier">request</span>[<span class="ruby-string">&quot;some_param&quot;</span>]       <span class="ruby-comment"># value of some_param parameter. [] is a shortcut to the params hash.</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">referrer</span>            <span class="ruby-comment"># the referrer of the client or &#39;/&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span>          <span class="ruby-comment"># user agent (used by :agent condition)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">cookies</span>             <span class="ruby-comment"># hash of browser cookies</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>                <span class="ruby-comment"># is this an ajax request?</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>                 <span class="ruby-comment"># &quot;http://example.com/example/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>                <span class="ruby-comment"># &quot;/example/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>                  <span class="ruby-comment"># client IP address</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">secure?</span>             <span class="ruby-comment"># false (would be true over ssl)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">forwarded?</span>          <span class="ruby-comment"># true (if running behind a reverse proxy)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>                 <span class="ruby-comment"># raw env hash handed in by Rack</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Some options, like <code>script_name</code> or <code>path_info</code>, can
also be written:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> { <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-string">&quot;/&quot;</span> }

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;all requests end up here&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The <code>request.body</code> is an IO or StringIO object:</p>

<pre class="ruby"><span class="ruby-identifier">post</span> <span class="ruby-string">&quot;/api&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">rewind</span>  <span class="ruby-comment"># in case someone already read it</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-node">&quot;Hello #{data[&#39;name&#39;]}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Attachments">Attachments<span><a href="#label-Attachments">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can use the <code>attachment</code> helper to tell the browser the
response should be stored on disk rather than displayed in the browser:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">attachment</span>
  <span class="ruby-string">&quot;store it!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can also pass it a file name:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">attachment</span> <span class="ruby-string">&quot;info.txt&quot;</span>
  <span class="ruby-string">&quot;store it!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Dealing+with+Date+and+Time">Dealing with Date and Time<span><a href="#label-Dealing+with+Date+and+Time">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="Sinatra.html">Sinatra</a> offers a <code>time_for</code> helper
method that generates a Time object from the given value. It is also able
to convert <code>DateTime</code>, <code>Date</code> and similar classes:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">time_for</span>(<span class="ruby-string">&#39;Dec 23, 2012&#39;</span>)
  <span class="ruby-string">&quot;still time&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This method is used internally by <code>expires</code>,
<code>last_modified</code> and akin. You can therefore easily extend the
behavior of those methods by overriding <code>time_for</code> in your
application:</p>

<pre class="ruby"><span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">time_for</span>(<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">yesterday</span> <span class="ruby-keyword">then</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span>
    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">tomorrow</span>  <span class="ruby-keyword">then</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">super</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">last_modified</span> :<span class="ruby-identifier">yesterday</span>
  <span class="ruby-identifier">expires</span> :<span class="ruby-identifier">tomorrow</span>
  <span class="ruby-string">&quot;hello&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Looking+Up+Template+Files">Looking Up Template Files<span><a href="#label-Looking+Up+Template+Files">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The <code>find_template</code> helper is used to find template files for
rendering:</p>

<pre class="ruby"><span class="ruby-identifier">find_template</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">views</span>, <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-constant">Tilt</span>[:<span class="ruby-identifier">haml</span>] <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;could be #{file}&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This is not really useful. But it is useful that you can actually override
this method to hook in your own lookup mechanism. For instance, if you want
to be able to use more than one view directory:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, [<span class="ruby-string">&#39;views&#39;</span>, <span class="ruby-string">&#39;templates&#39;</span>]

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-constant">Array</span>(<span class="ruby-identifier">views</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">super</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Another example would be using different directories for different engines:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, :<span class="ruby-identifier">sass</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;views/sass&#39;</span>, :<span class="ruby-identifier">haml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;templates&#39;</span>, :<span class="ruby-identifier">default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;views&#39;</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">folder</span> = <span class="ruby-identifier">views</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">engine</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Tilt</span>[<span class="ruby-identifier">k</span>] }
    <span class="ruby-identifier">folder</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">views</span>[:<span class="ruby-identifier">default</span>]
    <span class="ruby-keyword">super</span>(<span class="ruby-identifier">folder</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can also easily wrap this up in an extension and share with others!</p>

<p>Note that <code>find_template</code> does not check if the file really
exists but rather calls the given block for all possible paths. This is not
a performance issue, since <code>render</code> will use <code>break</code>
as soon as a file is found. Also, template locations (and content) will be
cached if you are not running in development mode. You should keep that in
mind if you write a really crazy method.</p>

<h2 id="label-Configuration">Configuration<span><a href="#label-Configuration">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Run once, at startup, in any environment:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># setting one option</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">option</span>, <span class="ruby-string">&#39;value&#39;</span>

  <span class="ruby-comment"># setting multiple options</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">a</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, :<span class="ruby-identifier">b</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>

  <span class="ruby-comment"># same as `set :option, true`</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">option</span>

  <span class="ruby-comment"># same as `set :option, false`</span>
  <span class="ruby-identifier">disable</span> :<span class="ruby-identifier">option</span>

  <span class="ruby-comment"># you can also have dynamic settings with blocks</span>
  <span class="ruby-identifier">set</span>(:<span class="ruby-identifier">css_dir</span>) { <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">views</span>, <span class="ruby-string">&#39;css&#39;</span>) }
<span class="ruby-keyword">end</span>
</pre>

<p>Run only when the environment (<code>RACK_ENV</code> environment variable)
is set to <code>:production</code>:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Run when the environment is set to either <code>:production</code> or
<code>:test</code>:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span>, :<span class="ruby-identifier">test</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can access those options via <code>settings</code>:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;bar&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">foo?</span> <span class="ruby-comment"># =&gt; true</span>
  <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">foo</span>  <span class="ruby-comment"># =&gt; &#39;bar&#39;</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Configuring+attack+protection">Configuring attack protection<span><a href="#label-Configuring+attack+protection">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="Sinatra.html">Sinatra</a> is using <a
href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a>
to defend your application against common, opportunistic attacks. You can
easily disable this behavior (which will open up your application to tons
of common vulnerabilities):</p>

<pre class="ruby"><span class="ruby-identifier">disable</span> :<span class="ruby-identifier">protection</span>
</pre>

<p>To skip a single defense layer, set <code>protection</code> to an options
hash:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">except</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">path_traversal</span>
</pre>

<p>You can also hand in an array in order to disable a list of protections:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">except</span> =<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">path_traversal</span>, :<span class="ruby-identifier">session_hijacking</span>]
</pre>

<p>By default, <a href="Sinatra.html">Sinatra</a> will only set up session
based protection if <code>:sessions</code> has been enabled. Sometimes you
want to set up sessions on your own, though. In that case you can get it to
set up session based protections by passing the <code>:session</code>
option:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Pool</span>
<span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">session</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
</pre>

<h3 id="label-Available+Settings">Available Settings<span><a href="#label-Available+Settings">&para;</a> <a href="#top">&uarr;</a></span></h3>
<dl>
  <dt>absolute_redirects</dt>
  <dd>
    If disabled, Sinatra will allow relative redirects, however, Sinatra will no
    longer conform with RFC 2616 (HTTP 1.1), which only allows absolute redirects.
  </dd>
  <dd>
    Enable if your app is running behind a reverse proxy that has not been set up
    properly. Note that the <tt>url</tt> helper will still produce absolute URLs, unless you
    pass in <tt>false</tt> as the second parameter.
  </dd>
  <dd>Disabled by default.</dd>

  <dt>add_charset</dt>
  <dd>
    Mime types the <tt>content_type</tt> helper will automatically add the charset info to.
    You should add to it rather than overriding this option:
    <tt>settings.add_charset << "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
    Path to the main application file, used to detect project root, views and public
    folder and inline templates.
  </dd>

  <dt>bind</dt>
  <dd>IP address to bind to (default: <tt>0.0.0.0</tt> <em>or</em>
  <tt>localhost</tt> if your `environment` is set to development). Only used
  for built-in server.</dd>

  <dt>default_encoding</dt>
  <dd>Encoding to assume if unknown (defaults to <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
  <dd>Display errors in the log.</dd>

  <dt>environment</dt>
  <dd>
    Current environment. Defaults to <tt>ENV['RACK_ENV']</tt>, or
    <tt>"development"</tt> if not available.
  </dd>

  <dt>logging</dt>
  <dd>Use the logger.</dd>

  <dt>lock</dt>
  <dd>
    Places a lock around every request, only running processing on request
    per Ruby process concurrently.
  </dd>
  <dd>Enabled if your app is not thread-safe. Disabled per default.</dd>

  <dt>method_override</dt>
  <dd>
    Use <tt>_method</tt> magic to allow put/delete forms in browsers that
    don't support it.
  </dd>

  <dt>port</dt>
  <dd>Port to listen on. Only used for built-in server.</dd>

  <dt>prefixed_redirects</dt>
  <dd>
    Whether or not to insert <tt>request.script_name</tt> into redirects if no
    absolute path is given. That way <tt>redirect '/foo'</tt> would behave like
    <tt>redirect to('/foo')</tt>. Disabled per default.
  </dd>

  <dt>protection</dt>
  <dd>Whether or not to enable web attack protections. See protection section
  above.</dd>

  <dt>public_dir</dt>
  <dd>Alias for <tt>public_folder</tt>. See below.</dd>

  <dt>public_folder</dt>
  <dd>
    Path to the folder public files are served from. Only used if static
    file serving is enabled (see <tt>static</tt> setting below). Inferred from
    <tt>app_file</tt> setting if not set.
  </dd>

  <dt>reload_templates</dt>
  <dd>
    Whether or not to reload templates between requests. Enabled in development
    mode.
  </dd>

  <dt>root</dt>
  <dd>
    Path to project root folder. Inferred from <tt>app_file</tt> setting if not
    set.
  </dd>

  <dt>raise_errors</dt>
  <dd>
    Raise exceptions (will stop application). Enabled by default when
    <tt>environment</tt> is set to <tt>"test"</tt>, disabled otherwise.
  </dd>

  <dt>run</dt>
  <dd>
    If enabled, Sinatra will handle starting the web server. Do not
    enable if using rackup or other means.
  </dd>

  <dt>running</dt>
  <dd>Is the built-in server running now? Do not change this setting!</dd>

  <dt>server</dt>
  <dd>
    Server or list of servers to use for built-in server. Order indicates
    priority, default depends on Ruby implementation.
  </dd>

  <dt>sessions</dt>
  <dd>
    Enable cookie-based sessions support using <tt>Rack::Session::Cookie</tt>.
    See 'Using Sessions' section for more information.
  </dd>

  <dt>show_exceptions</dt>
  <dd>
    Show a stack trace in the browser when an exception happens. Enabled by
    default when <tt>environment</tt> is set to <tt>"development"</tt>,
    disabled otherwise.
  </dd>
  <dd>
    Can also be set to <tt>:after_handler</tt> to trigger app-specified error
    handling before showing a stack trace in the browser.
  </dd>

  <dt>static</dt>
  <dd>Whether Sinatra should handle serving static files.</dd>
  <dd>Disable when using a server able to do this on its own.</dd>
  <dd>Disabling will boost performance.</dd>
  <dd>
    Enabled per default in classic style, disabled for modular apps.
  </dd>

  <dt>static_cache_control</dt>
  <dd>
    When Sinatra is serving static files, set this to add <tt>Cache-Control</tt>
    headers to the responses. Uses the <tt>cache_control</tt> helper. Disabled
    by default.
  </dd>
  <dd>
    Use an explicit array when setting multiple values:
    <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd>
    If set to <tt>true</tt>, will tell Thin to use <tt>EventMachine.defer</tt>
    for processing the request.
  </dd>

  <dt>traps</dt>
  <dd>Whether Sinatra should handle system signals.</dd>

  <dt>views</dt>
  <dd>
    Path to the views folder. Inferred from <tt>app_file</tt> setting if
    not set.
  </dd>

  <dt>x_cascade</dt>
  <dd>
    Whether or not to set the X-Cascade header if no route matches.
    Defaults to <tt>true</tt>.
  </dd>
</dl>
<h2 id="label-Environments">Environments<span><a href="#label-Environments">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>There are three predefined <code>environments</code>:
<code>&quot;development&quot;</code>, <code>&quot;production&quot;</code>
and <code>&quot;test&quot;</code>. Environments can be set through the
<code>RACK_ENV</code> environment variable. The default value is
<code>&quot;development&quot;</code>. In the
<code>&quot;development&quot;</code> environment all templates are reloaded
between requests, and special <code>not_found</code> and <code>error</code>
handlers display stack traces in your browser. In the
<code>&quot;production&quot;</code> and <code>&quot;test&quot;</code>
environments, templates are cached by default.</p>

<p>To run different environments, set the <code>RACK_ENV</code> environment
variable:</p>

<pre class="ruby"><span class="ruby-constant">RACK_ENV</span>=<span class="ruby-identifier">production</span> <span class="ruby-identifier">ruby</span> <span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>You can use predefined methods: <code>development?</code>,
<code>test?</code> and <code>production?</code> to check the current
environment setting:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">development?</span>
    <span class="ruby-string">&quot;development!&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;not development!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Error+Handling">Error Handling<span><a href="#label-Error+Handling">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Error handlers run within the same context as routes and before filters,
which means you get all the goodies it has to offer, like
<code>haml</code>, <code>erb</code>, <code>halt</code>, etc.</p>

<h3 id="label-Not+Found">Not Found<span><a href="#label-Not+Found">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When a <code>Sinatra::NotFound</code> exception is raised, or the
response&#39;s status code is 404, the <code>not_found</code> handler is
invoked:</p>

<pre class="ruby"><span class="ruby-identifier">not_found</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;This is nowhere to be found.&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Error">Error<span><a href="#label-Error">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The <code>error</code> handler is invoked any time an exception is raised
from a route block or a filter. But note in development it will only run if
you set the show exceptions option to <code>:after_handler</code>:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">show_exceptions</span>, :<span class="ruby-identifier">after_handler</span>
</pre>

<p>The exception object can be obtained from the <code>sinatra.error</code> <a
href="Rack.html">Rack</a> variable:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Sorry there was a nasty error - &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Custom errors:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-constant">MyCustomError</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;So what happened was...&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Then, if this happens:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">MyCustomError</span>, <span class="ruby-string">&#39;something bad&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You get this:</p>

<pre>So what happened was... something bad</pre>

<p>Alternatively, you can install an error handler for a status code:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">403</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Access forbidden&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/secret&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-value">403</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Or a range:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">400</span><span class="ruby-operator">..</span><span class="ruby-value">510</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Boom&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p><a href="Sinatra.html">Sinatra</a> installs special <code>not_found</code>
and <code>error</code> handlers when running under the development
environment to display nice stack traces and additional debugging
information in your browser.</p>

<h2 id="label-Rack+Middleware"><a href="Rack.html">Rack</a> Middleware<span><a href="#label-Rack+Middleware">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="Sinatra.html">Sinatra</a> rides on <a
href="http://rack.github.io/">Rack</a>, a minimal standard interface for
Ruby web frameworks. One of Rack&#39;s most interesting capabilities for
application developers is support for middleware  components that sit
between the server and your application monitoring and/or manipulating the
HTTP request/response to provide various types of common functionality.</p>

<p><a href="Sinatra.html">Sinatra</a> makes building <a
href="Rack.html">Rack</a> middleware pipelines a cinch via a top-level
<code>use</code> method:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;my_custom_middleware&#39;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Lint</span>
<span class="ruby-identifier">use</span> <span class="ruby-constant">MyCustomMiddleware</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello World&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The semantics of <code>use</code> are identical to those defined for the <a
href="http://rubydoc.info/github/rack/rack/master/Rack/Builder">Rack::Builder</a>
DSL (most frequently used from rackup files). For example, the
<code>use</code> method accepts multiple/variable args as well as blocks:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Auth</span><span class="ruby-operator">::</span><span class="ruby-constant">Basic</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">username</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;secret&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p><a href="Rack.html">Rack</a> is distributed with a variety of standard
middleware for logging, debugging, URL routing, authentication, and session
handling. <a href="Sinatra.html">Sinatra</a> uses many of these components
automatically based on configuration so you typically don&#39;t have to
<code>use</code> them explicitly.</p>

<p>You can find useful middleware in <a
href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>, <a
href="https://github.com/rack/rack-contrib#readm">rack-contrib</a>, or in
the <a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack
wiki</a>.</p>

<h2 id="label-Testing">Testing<span><a href="#label-Testing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="Sinatra.html">Sinatra</a> tests can be written using any
Rack-based testing library or framework. <a
href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>
is recommended:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;my_sinatra_app&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;minitest/autorun&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rack/test&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyAppTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Minitest</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">Methods</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">app</span>
    <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_my_default</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Hello World!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_with_params</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/meet&#39;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Frank&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Hello Frank!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_with_rack_env</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, {}, <span class="ruby-string">&#39;HTTP_USER_AGENT&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Songbird&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;You&#39;re using Songbird!&quot;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note: If you are using <a href="Sinatra.html">Sinatra</a> in the modular
style, replace <code>Sinatra::Application</code> above with the class name
of your app.</p>

<h2 id="label-Sinatra-3A-3ABase+-+Middleware-2C+Libraries-2C+and+Modular+Apps">Sinatra::Base - Middleware, Libraries, and Modular Apps<span><a href="#label-Sinatra-3A-3ABase+-+Middleware-2C+Libraries-2C+and+Modular+Apps">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Defining your app at the top-level works well for micro-apps but has
considerable drawbacks when building reusable components such as <a
href="Rack.html">Rack</a> middleware, Rails metal, simple libraries with a
server component, or even <a href="Sinatra.html">Sinatra</a> extensions.
The top-level assumes a micro-app style configuration (e.g., a single
application file, <code>./public</code> and <code>./views</code>
directories, logging, exception detail page, etc.). That&#39;s where
<code>Sinatra::Base</code> comes into play:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;bar&#39;</span>

  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-string">&#39;Hello world!&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The methods available to <code>Sinatra::Base</code> subclasses are exactly
the same as those available via the top-level DSL. Most top-level apps can
be converted to <code>Sinatra::Base</code> components with two
modifications:</p>

<p>Your file should require <code>sinatra/base</code> instead of
<code>sinatra</code>;  otherwise, all of Sinatra&#39;s DSL methods are
imported into the main  namespace.  Put your app&#39;s routes, error
handlers, filters, and options in a subclass  of
<code>Sinatra::Base</code>.</p>

<p><code>Sinatra::Base</code> is a blank slate. Most options are disabled by
default, including the built-in server. See <a
href="http://sinatra.github.com/configuration.html">Configuring
Settings</a> for details on available options and their behavior. If you
want behavior more similar to when you define your app at the top level
(also known as Classic style), you can subclass
<code>Sinatra::Application</code>.</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-string">&#39;Hello world!&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Modular+vs.+Classic+Style">Modular vs. Classic Style<span><a href="#label-Modular+vs.+Classic+Style">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Contrary to common belief, there is nothing wrong with the classic style.
If it suits your application, you do not have to switch to a modular
application.</p>

<p>The main disadvantage of using the classic style rather than the modular
style is that you will only have one <a href="Sinatra.html">Sinatra</a>
application per Ruby process. If you plan to use more than one, switch to
the modular style. There is no reason you cannot mix the modular and the
classic styles.</p>

<p>If switching from one style to the other, you should be aware of slightly
different default settings:</p>
<table>
  <tr>
    <th>Setting</th>
    <th>Classic</th>
    <th>Modular</th>
    <th>Modular</th>
  </tr>

  <tr>
    <td>app_file</td>
    <td>file loading sinatra</td>
    <td>file subclassing Sinatra::Base</td>
    <td>file subclassing Sinatra::Application</td>
  </tr>

  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
    <td>false</td>
  </tr>

  <tr>
    <td>logging</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>static</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>
</table>
<h3 id="label-Serving+a+Modular+Application">Serving a Modular Application<span><a href="#label-Serving+a+Modular+Application">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>There are two common options for starting a modular app, actively starting
with <code>run!</code>:</p>

<pre class="ruby"><span class="ruby-comment"># my_app.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># ... app code here ...</span>

  <span class="ruby-comment"># start the server if ruby file executed directly</span>
  <span class="ruby-identifier">run!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$0</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Start with:</p>

<pre class="ruby"><span class="ruby-identifier">ruby</span> <span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>Or with a <code>config.ru</code> file, which allows using any <a
href="Rack.html">Rack</a> handler:</p>

<pre class="ruby"><span class="ruby-comment"># config.ru (run with rackup)</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;./my_app&#39;</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">MyApp</span>
</pre>

<p>Run:</p>

<pre>rackup -p 4567</pre>

<h3 id="label-Using+a+Classic+Style+Application+with+a+config.ru">Using a Classic Style Application with a config.ru<span><a href="#label-Using+a+Classic+Style+Application+with+a+config.ru">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Write your app file:</p>

<pre class="ruby"><span class="ruby-comment"># app.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello world!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>And a corresponding <code>config.ru</code>:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;./app&#39;</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
</pre>

<h3 id="label-When+to+use+a+config.ru-3F">When to use a config.ru?<span><a href="#label-When+to+use+a+config.ru-3F">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A <code>config.ru</code> file is recommended if:</p>

<p>You want to deploy with a different <a href="Rack.html">Rack</a> handler
(Passenger, Unicorn,  Heroku, ).  You want to use more than one subclass
of <code>Sinatra::Base</code>.  You want to use <a
href="Sinatra.html">Sinatra</a> only for middleware, and not as an
endpoint.</p>

<p><em>There is no need to switch to a <code>config.ru</code> simply because
you switched to the modular style, and you don&#39;t have to use the
modular style for running with a <code>config.ru</code>.</em>*</p>

<h3 id="label-Using+Sinatra+as+Middleware">Using <a href="Sinatra.html">Sinatra</a> as Middleware<span><a href="#label-Using+Sinatra+as+Middleware">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Not only is <a href="Sinatra.html">Sinatra</a> able to use other <a
href="Rack.html">Rack</a> middleware, any <a
href="Sinatra.html">Sinatra</a> application can in turn be added in front
of any <a href="Rack.html">Rack</a> endpoint as middleware itself. This
endpoint could be another <a href="Sinatra.html">Sinatra</a> application,
or any other Rack-based application (Rails/Ramaze/Camping/):</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">LoginScreen</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/login&#39;</span>) { <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">login</span> }

  <span class="ruby-identifier">post</span>(<span class="ruby-string">&#39;/login&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;password&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;user_name&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;/login&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># middleware will run before filters</span>
  <span class="ruby-identifier">use</span> <span class="ruby-constant">LoginScreen</span>

  <span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;user_name&#39;</span>]
      <span class="ruby-identifier">halt</span> <span class="ruby-string">&quot;Access denied, please &lt;a href=&#39;/login&#39;&gt;login&lt;/a&gt;.&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-node">&quot;Hello #{session[&#39;user_name&#39;]}.&quot;</span> }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Dynamic+Application+Creation">Dynamic Application Creation<span><a href="#label-Dynamic+Application+Creation">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sometimes you want to create new applications at runtime without having to
assign them to a constant. You can do this with <code>Sinatra.new</code>:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>
<span class="ruby-identifier">my_app</span> = <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&quot;hi&quot;</span> } }
<span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">run!</span>
</pre>

<p>It takes the application to inherit from as an optional argument:</p>

<pre class="ruby"><span class="ruby-comment"># config.ru (run with rackup)</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-identifier">controller</span> = <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">logging</span>
  <span class="ruby-identifier">helpers</span> <span class="ruby-constant">MyHelpers</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">map</span>(<span class="ruby-string">&#39;/a&#39;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">controller</span>) { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&#39;a&#39;</span> } }
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">map</span>(<span class="ruby-string">&#39;/b&#39;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">controller</span>) { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&#39;b&#39;</span> } }
<span class="ruby-keyword">end</span>
</pre>

<p>This is especially useful for testing <a href="Sinatra.html">Sinatra</a>
extensions or using <a href="Sinatra.html">Sinatra</a> in your own library.</p>

<p>This also makes using <a href="Sinatra.html">Sinatra</a> as middleware
extremely easy:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Sinatra</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-operator">...</span> }
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">run</span> <span class="ruby-constant">RailsProject</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
</pre>

<h2 id="label-Scopes+and+Binding">Scopes and Binding<span><a href="#label-Scopes+and+Binding">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The scope you are currently in determines what methods and variables are
available.</p>

<h3 id="label-Application-2FClass+Scope">Application/Class Scope<span><a href="#label-Application-2FClass+Scope">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Every <a href="Sinatra.html">Sinatra</a> application corresponds to a
subclass of <code>Sinatra::Base</code>. If you are using the top-level DSL
(<code>require &#39;sinatra&#39;</code>), then this class is
<code>Sinatra::Application</code>, otherwise it is the subclass you created
explicitly. At class level you have methods like <code>get</code> or
<code>before</code>, but you cannot access the <code>request</code> or
<code>session</code> objects, as there is only a single application class
for all requests.</p>

<p>Options created via <code>set</code> are methods at class level:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># Hey, I&#39;m in the application scope!</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-value">42</span>
  <span class="ruby-identifier">foo</span> <span class="ruby-comment"># =&gt; 42</span>

  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Hey, I&#39;m no longer in the application scope!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You have the application scope binding inside:</p>

<p>Your application class body  Methods defined by extensions  The block
passed to <code>helpers</code>  Procs/blocks used as value for
<code>set</code>  The block passed to <code>Sinatra.new</code></p>

<p>You can reach the scope object (the class) like this:</p>

<p>Via the object passed to configure blocks (<code>configure { |c| ...
}</code>)  <code>settings</code> from within the request scope</p>

<h3 id="label-Request-2FInstance+Scope">Request/Instance Scope<span><a href="#label-Request-2FInstance+Scope">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For every incoming request, a new instance of your application class is
created, and all handler blocks run in that scope. From within this scope
you can access the <code>request</code> and <code>session</code> objects or
call rendering methods like <code>erb</code> or <code>haml</code>. You can
access the application scope from within the request scope via the
<code>settings</code> helper:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># Hey, I&#39;m in the application scope!</span>
  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/define_route/:name&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Request scope for &#39;/define_route/:name&#39;</span>
    <span class="ruby-ivar">@value</span> = <span class="ruby-value">42</span>

    <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">get</span>(<span class="ruby-node">&quot;/#{params[&#39;name&#39;]}&quot;</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-comment"># Request scope for &quot;/#{params[&#39;name&#39;]}&quot;</span>
      <span class="ruby-ivar">@value</span> <span class="ruby-comment"># =&gt; nil (not the same request)</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-string">&quot;Route defined!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You have the request scope binding inside:</p>

<p>get, head, post, put, delete, options, patch, link, and unlink blocks 
before and after filters  helper methods  templates/views</p>

<h3 id="label-Delegation+Scope">Delegation Scope<span><a href="#label-Delegation+Scope">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The delegation scope just forwards methods to the class scope. However, it
does not behave exactly like the class scope, as you do not have the class
binding. Only methods explicitly marked for delegation are available, and
you do not share variables/state with the class scope (read: you have a
different <code>self</code>). You can explicitly add method delegations by
calling <code>Sinatra::Delegator.delegate :method_name</code>.</p>

<p>You have the delegate scope binding inside:</p>

<p>The top level binding, if you did <code>require &quot;sinatra&quot;</code> 
An object extended with the <code>Sinatra::Delegator</code> mixin</p>

<p>Have a look at the code for yourself: here&#39;s the <a
href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator
mixin</a> being <a
href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">extending
the main object</a>.</p>

<h2 id="label-Command+Line">Command Line<span><a href="#label-Command+Line">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="Sinatra.html">Sinatra</a> applications can be run directly:</p>

<pre>ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]</pre>

<p>Options are:</p>

<pre class="ruby"><span class="ruby-operator">-</span><span class="ruby-identifier">h</span> <span class="ruby-comment"># help</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">p</span> <span class="ruby-comment"># set the port (default is 4567)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">o</span> <span class="ruby-comment"># set the host (default is 0.0.0.0)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">e</span> <span class="ruby-comment"># set the environment (default is development)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">s</span> <span class="ruby-comment"># specify rack server/handler (default is thin)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-comment"># turn on the mutex lock (default is off)</span>
</pre>

<h2 id="label-Requirement">Requirement<span><a href="#label-Requirement">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The following Ruby versions are officially supported: &lt;dl&gt; 
&lt;dt&gt;Ruby 1.8.7&lt;/dt&gt;  &lt;dd&gt;  1.8.7 is fully supported,
however, if nothing is keeping you from it, we  recommend upgrading or
switching to JRuby or Rubinius. Support for 1.8.7  will not be dropped
before <a href="Sinatra.html">Sinatra</a> 2.0. Ruby 1.8.6 is no longer
supported.  &lt;/dd&gt;</p>

<p>&lt;dt&gt;Ruby 1.9.2&lt;/dt&gt;  &lt;dd&gt;  1.9.2 is fully supported. Do
not use 1.9.2p0, as it is known to cause  segmentation faults when running
<a href="Sinatra.html">Sinatra</a>. Official support will continue  at
least until the release of <a href="Sinatra.html">Sinatra</a> 1.5. 
&lt;/dd&gt;</p>

<p>&lt;dt&gt;Ruby 1.9.3&lt;/dt&gt;  &lt;dd&gt;  1.9.3 is fully supported and
recommended. Please note that switching to 1.9.3  from an earlier version
will invalidate all sessions. 1.9.3 will be supported  until the release of
<a href="Sinatra.html">Sinatra</a> 2.0.  &lt;/dd&gt;</p>

<p>&lt;dt&gt;Ruby 2.x&lt;/dt&gt;  &lt;dd&gt;  2.x is fully supported and
recommended. There are currently no plans to drop  official support for it.
&lt;/dd&gt;</p>

<p>&lt;dt&gt;Rubinius&lt;/dt&gt;  &lt;dd&gt;  Rubinius is officially supported
(Rubinius &gt;= 2.x). It is recommended to  <code>gem install puma</code>. 
&lt;/dd&gt;</p>

<p>&lt;dt&gt;JRuby&lt;/dt&gt;  &lt;dd&gt;  The latest stable release of JRuby
is officially supported. It is not  recommended to use C extensions with
JRuby. It is recommended to  <code>gem install trinidad</code>. 
&lt;/dd&gt; &lt;/dl&gt;</p>

<p>We also keep an eye on upcoming Ruby versions.</p>

<p>The following Ruby implementations are not officially supported but still
are known to run Sinatra:</p>

<p>Older versions of JRuby and Rubinius  Ruby Enterprise Edition  MacRuby,
Maglev, IronRuby  Ruby 1.9.0 and 1.9.1 (but we do recommend against using
those)</p>

<p>Not being officially supported means if things only break there and not on
a supported platform, we assume it&#39;s not our issue but theirs.</p>

<p>We also run our CI against ruby-head (future releases of MRI), but we
can&#39;t guarantee anything, since it is constantly moving. Expect
upcoming 2.x releases to be fully supported.</p>

<p><a href="Sinatra.html">Sinatra</a> should work on any operating system
supported by the chosen Ruby implementation.</p>

<p>If you run MacRuby, you should <code>gem install control_tower</code>.</p>

<p><a href="Sinatra.html">Sinatra</a> currently doesn&#39;t run on Cardinal,
SmallRuby, BlueRuby or any Ruby version prior to 1.8.7.</p>

<h2 id="label-The+Bleeding+Edge">The Bleeding Edge<span><a href="#label-The+Bleeding+Edge">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If you would like to use Sinatra&#39;s latest bleeding-edge code, feel free
to run your application against the master branch, it should be rather
stable.</p>

<p>We also push out prerelease gems from time to time, so you can do a</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">sinatra</span> <span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">pre</span>
</pre>

<p>to get some of the latest features.</p>

<h3 id="label-With+Bundler">With Bundler<span><a href="#label-With+Bundler">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If you want to run your application with the latest <a
href="Sinatra.html">Sinatra</a>, using <a
href="http://gembundler.com/">Bundler</a> is the recommended way.</p>

<p>First, install bundler, if you haven&#39;t:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">bundler</span>
</pre>

<p>Then, in your project directory, create a <code>Gemfile</code>:</p>

<pre class="ruby"><span class="ruby-identifier">source</span> <span class="ruby-string">&#39;https://rubygems.org&#39;</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;sinatra&#39;</span>, :<span class="ruby-identifier">github</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sinatra/sinatra&quot;</span>

<span class="ruby-comment"># other dependencies</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;haml&#39;</span>                    <span class="ruby-comment"># for instance, if you use haml</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;activerecord&#39;</span>, <span class="ruby-string">&#39;~&gt; 3.0&#39;</span>  <span class="ruby-comment"># maybe you also need ActiveRecord 3.x</span>
</pre>

<p>Note that you will have to list all your application&#39;s dependencies in
the <code>Gemfile</code>. Sinatra&#39;s direct dependencies (Rack and Tilt)
will, however, be automatically fetched and added by Bundler.</p>

<p>Now you can run your app like this:</p>

<pre class="ruby"><span class="ruby-identifier">bundle</span> <span class="ruby-identifier">exec</span> <span class="ruby-identifier">ruby</span> <span class="ruby-identifier">myapp</span>.<span class="ruby-identifier">rb</span>
</pre>

<h3 id="label-Roll+Your+Own">Roll Your Own<span><a href="#label-Roll+Your+Own">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Create a local clone and run your app with the <code>sinatra/lib</code>
directory on the <code>$LOAD_PATH</code>:</p>

<pre>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib myapp.rb</pre>

<p>To update the <a href="Sinatra.html">Sinatra</a> sources in the future:</p>

<pre class="ruby"><span class="ruby-identifier">cd</span> <span class="ruby-identifier">myapp</span><span class="ruby-operator">/</span><span class="ruby-identifier">sinatra</span>
<span class="ruby-identifier">git</span> <span class="ruby-identifier">pull</span>
</pre>

<h3 id="label-Install+Globally">Install Globally<span><a href="#label-Install+Globally">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can build the gem on your own:</p>

<pre>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install</pre>

<p>If you install gems as root, the last step should be:</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">rake</span> <span class="ruby-identifier">install</span>
</pre>

<h2 id="label-Versioning">Versioning<span><a href="#label-Versioning">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="Sinatra.html">Sinatra</a> follows <a
href="http://semver.org/">Semantic Versioning</a>, both SemVer and
SemVerTag.</p>

<h2 id="label-Further+Reading">Further Reading<span><a href="#label-Further+Reading">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="http://www.sinatrarb.com/">Project Website</a> - Additional
documentation,  news, and links to other resources.  <a
href="http://www.sinatrarb.com/contributing">Contributing</a> - Find a bug?
Need  help? Have a patch?  <a
href="http://github.com/sinatra/sinatra/issues">Issue tracker</a>  <a
href="http://twitter.com/sinatra">Twitter</a>  <a
href="http://groups.google.com/group/sinatrarb/topics">Mailing List</a> 
IRC: <a href="irc://chat.freenode.net/#sinatra">#sinatra</a> on <a
href="http://freenode.net">freenode.net</a>  <a
href="https://github.com/sinatra/sinatra-book/">Sinatra Book</a> Cookbook
Tutorial  <a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a>
Community  contributed recipes  API documentation for the <a
href="http://rubydoc.info/gems/sinatra">latest release</a>  or the <a
href="http://rubydoc.info/github/sinatra/sinatra">current HEAD</a> on  <a
href="http://rubydoc.info">rubydoc.info</a>  <a
href="http://travis-ci.org/sinatra/sinatra">CI server</a></p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

